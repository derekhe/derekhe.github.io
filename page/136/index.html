<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="aZ679hf2Rw"><title> 我是思聪</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.april1985.com/atom.xml" title="我是思聪"><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129409069-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129409069-1');
</script>


<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">我是思聪</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>现在</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>曾经</p></a><ul class="shortcut-icons"><a href="https://github.com/derekhe" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="body-container"><div id="post-list" class="left"><div class="home post-list"><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/post/2005-04-07-mobile-phone-management-software-develop-experience-on-net-platform-chapter-1-to-3/" class="post-title-link">Mobile phone management software develop experience on .Net Platform (Chapter 1 to 3)</a></h2><div class="post-info">Apr 7, 2005</div><div class="post-content"><p>Mobile phone management software develop experience on .Net Platform<br>Chapter 1<br>Introduction<br>After studying of many aspects of mobile management software development, I finally had written my Siemens Support Tool using VB.Net. Although I have not really finished it due to time limit, the core is developed well and the interface is OK on the whole. My purpose in studying software development is achieved. I stopped this project on February 12th and I want to summaries the works I’ve done on my winter holiday. So I write out what I have learned, in order to review it later and help some one working on analogous work. Because I’m after-hours programmer, so if you find some mistakes, please contact me! Thanks!</p>
<p>Chapter 2<br>Why do you design it? What’s your aim?<br>The one who are using or have used Siemens Mobile Phones will be very pleased at their humanity  design. To my disappointment, the official management software SDS is not well designed. It’s hard to use and has a low speed. The newest version software for 65 platform which is called Mobile Phone Manager seems much better than before, but it takes 120MB space on my tiny hard disk and also has a very low speed.<br>GhostMobile (GM for short) is a good nonofficial freeware I ever used. But it often stops while transferring files. I guess no time-out error handle was designed. It is also very slow in transferring files, and is not very convenient to manage SMS.<br>Siemens Mobile Control (SiMoCo for short) is also nonofficial software. It has only 800kb in size but with fast operating speed and powerful functions. But after I used it, I found it is hard to use, it seems be designed for experts, and is not well supported Chinese.<br>So the final aim is to design software with file transferring, SMS, note management, task management and calendar management.</p>
<p>Chapter 3<br>Prepare<br>In the summer holiday of 2004, I was done a part functions for file transferring and SMS. I named it M55 File Transfer Tool at that time. After the alpha publish on Dongbei Mobile Ne t(<a href="http://bbs.dbsjw.com/" target="_blank" rel="noopener">http://bbs.dbsjw.com</a>), I found some phones which can’t connected by GM can be connected by my program. But many bugs were found.<br>The portion of SMS is based on ATC_Command_Set_For_L55_Platform. You can download it from either the official site or my site. It describes AT Command Set for Siemens 55 Platform in detail. Actually, the AT Commands for SMS are the same for different manufacturer. But the portion for file transferring is much difficult to explorer.<br>No official documents describe how to transfer data between phone and PC. I monitored the whole COM operation by Serial Monitor. But all I found was hex values which confused me a lot! What structure does it have?<br>I have searched Google for answer and posted questions on CSDN. No one knew this, but a friend gives me some thread, he said that maybe part of Bluetooth protocol. Yes, after my Google search on Bluetooth protocol, I found IrDA Protocol. The IrOBEX protocol attracted me! The hex is well structured according to this protocol.<br>After my carefully study of the hex values, I found that the phone use OBEX to transfer data. Today, this problem seems somewhat drollness, when I saw the state of serial monitor in manufacture mode of phone changed from GIPSY to OBEX, what am I thinking of at that time?<br>Gradually, I know how to read and write phonebook, note, and calendar by OBEX. I wrote a OBEX class by VB.Net, but its code was hard to read and modify and with a low efficiency. I finally rewrite this class in my new program.<br>The new program was started at January 14th, 2005. I almost wrote the whole old program. To me, a beginner, it is a tremendous challenge.</p>
</div></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/post/2005-04-02-after-breaking-up-the-sky-very-blue-very-beautiful/" class="post-title-link">分手后的天空，很蓝，很美</a></h2><div class="post-info">Apr 2, 2005</div><div class="post-content"><p>这个星期就像是电视连续剧一样的，把一段感情渐渐的演完。分手，离别，做朋友，痛苦，失落，觉醒，感激。大学里的爱情，纯纯的，分手只是一个过程，一种磨练。</p>
<p>这星期的前几天，每天晚上，当我悲伤的时候，天也就下起了小雨；星期四拥抱着说再见的时候，雨下得更大了，一整夜都在下，似乎想把所有伤心和痛苦就在那一夜下完，哭完。第二天，愚人节，我们成了朋友，太阳露出了笑脸，天空很蓝。似乎一切都是安排好一样，很自然，很轻松。然而那个曾经他的男友，不甘心就这样离去，让他伤心吧，他只存在于过去，让我渐渐的磨灭他的存在，留下一片记忆。</p>
<p>158天，我是她现在最长的一个。我的初恋，也就这样结束了。虽然彼此的伤心在分手后越演越浓，雨越下越大，但终于，天晴了。很庆幸没有给20岁留下遗憾，过去只存在于19岁的我，懵懂、幼稚。分手后只能比分手前过得更快乐，不然，我们彼此对不起当时的决定。</p>
<p>在大学里面恋爱的朋友们，或许你们曾经向往过幸福，有过对未来的憧憬。可是，大多数的人都是会面对分手。这份感情没有任何基础，很轻很轻，不能关联家庭、生活、事业，或许真的未曾会有真正的未来。分手后不要伤心，不管是由于什么理由，把它当成是一份锻炼，学会在孤独中绝望，在绝望中坚强。分手后不可以伤害彼此，你们可以做朋友，而且是好朋友，因为彼此更了解。爱不可以轻率，一旦决定，就要做好最后的准备。</p>
<p>对于没有恋爱的朋友们，不要拒绝这份爱，虽然它很难成功，但是人生将会由于有这样的回忆而更精彩。就像我们一旦出生就决定了最终的死亡，我们活在这个世界上，希望看到更多，体会到更多。不要拒绝大学的爱情，纯纯的，美丽的，当步入社会之后，可能再也无法寻觅到这样的甜蜜和温柔。</p>
<p>可爱的草，曾经的女友，现在的好友，不悲伤，不气馁，正是由于你，才是我曾经的生活多了一份甜蜜，多了一份思念，多了一份伤感……</p>
<p>未爱过的人，尝试去爱；在爱中的人，好好的爱；爱过的人，生活中还有更多的精彩……</p>
</div></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/post/2005-04-01-i-only-like-you/" class="post-title-link">我只喜欢你</a></h2><div class="post-info">Apr 1, 2005</div><div class="post-content"><p>无意中遇见意中的你</p>
<p>听懂彼此的呼吸</p>
<p>太不可思议</p>
<p>心都被你看见</p>
<p>绝对的知己</p>
<p>把记忆中的那些花絮</p>
<p>变成了浪漫的甜蜜</p>
<p>想和你演绎</p>
<p>在风和日丽的那次相遇</p>
<p>我只喜欢你</p>
<p>是奉了爱的指引</p>
<p>没有谁可能代替</p>
<p>那种感觉不言而喻</p>
<p>那种感觉不言而喻</p>
<p>……</p>
</div></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/post/2005-03-18-howto-turn-off-pda-display-while-your-application-is-running-vb-net-c-net-cf-ppc2003/" class="post-title-link">HOWTO:Turn Off PDA Display while your application is running.(VB.Net/c#+.Net CF+PPC2003)</a></h2><div class="post-info">Mar 18, 2005</div><div class="post-content"><p>Core code for VB.NET:</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line">Namespace PDA</span><br><span class="line">Public Class Video</span><br><span class="line">Private Const SETPOWERMANAGEMENT As Int32 = <span class="number">6147</span></span><br><span class="line">Declare Function ExtEscapeSet Lib <span class="string">"coredll"</span> Alias <span class="string">"ExtEscape"</span> (ByVal hdc As IntPtr, _</span><br><span class="line">ByVal nEscape As Int32, _</span><br><span class="line">ByVal cbInput As Int32, _</span><br><span class="line"><span class="function">ByVal plszInData As <span class="title">Byte</span>(<span class="params"></span>), _</span></span><br><span class="line"><span class="function">ByVal cbOutput As Int32, _</span></span><br><span class="line"><span class="function">ByVal lpszOutData As IntPtr) As Int32</span></span><br><span class="line"><span class="function">Declare Function GetDC Lib "coredll" (<span class="params">ByVal hwnd As IntPtr</span>) As IntPtr</span></span><br><span class="line"><span class="function">Public Enum VideoPowerState As Integer</span></span><br><span class="line"><span class="function">VideoPowerOn</span> = <span class="number">1</span></span><br><span class="line">VideoPowerStandBy</span><br><span class="line">VideoPowerSuspend</span><br><span class="line">VideoPowerOff</span><br><span class="line">End Enum</span><br><span class="line"><span class="function">Public Shared Sub <span class="title">PowerOff</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">Dim hdc As IntPtr</span> = GetDC(IntPtr.Zero)</span><br><span class="line"><span class="function">Dim <span class="title">vpm</span>(<span class="params"></span>) As Byte</span> = &#123;<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, VideoPowerState.VideoPowerOff, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;</span><br><span class="line">ExtEscapeSet(hdc, SETPOWERMANAGEMENT, <span class="number">12</span>, vpm, <span class="number">0</span>, IntPtr.Zero)</span><br><span class="line">End Sub</span><br><span class="line"><span class="function">Public Shared Sub <span class="title">PowerOn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">Dim hdc As IntPtr</span> = GetDC(IntPtr.Zero)</span><br><span class="line"><span class="function">Dim <span class="title">vpm</span>(<span class="params"></span>) As Byte</span> = &#123;<span class="number">12</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, VideoPowerState.VideoPowerOn, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;</span><br><span class="line">ExtEscapeSet(hdc, SETPOWERMANAGEMENT, <span class="number">12</span>, vpm, <span class="number">0</span>, IntPtr.Zero)</span><br><span class="line">End Sub</span><br><span class="line">End Class</span><br><span class="line">End Namespace</span><br><span class="line">Core code <span class="keyword">for</span> C<span class="meta">#</span></span><br><span class="line"><span class="keyword">using</span> System;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.InteropServices;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">OpenNETCF</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Summary description for Video.</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Video</span></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// GDI Escapes for ExtEscape()</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">uint</span> QUERYESCSUPPORT = <span class="number">8</span>;</span><br><span class="line"><span class="comment">// The following are unique to CE</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">uint</span> GETVFRAMEPHYSICAL = <span class="number">6144</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">uint</span> GETVFRAMELEN = <span class="number">6145</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">uint</span> DBGDRIVERSTAT = <span class="number">6146</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">uint</span> SETPOWERMANAGEMENT = <span class="number">6147</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">const</span> <span class="keyword">uint</span> GETPOWERMANAGEMENT = <span class="number">6148</span>;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PowerOff</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">IntPtr hdc = GetDC(IntPtr.Zero);</span><br><span class="line"><span class="keyword">uint</span> func = SETPOWERMANAGEMENT;</span><br><span class="line"><span class="keyword">uint</span> size = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">byte</span>[] vpm = <span class="keyword">new</span> <span class="keyword">byte</span>[size];</span><br><span class="line"></span><br><span class="line"><span class="comment">//structure size</span></span><br><span class="line">BitConverter.GetBytes(size).CopyTo(vpm, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//dpms version</span></span><br><span class="line">BitConverter.GetBytes(<span class="number">0x0001</span>).CopyTo(vpm, <span class="number">4</span>);</span><br><span class="line"><span class="comment">//power state</span></span><br><span class="line">BitConverter.GetBytes((<span class="keyword">uint</span>)VideoPowerState.VideoPowerOff).CopyTo(vpm, <span class="number">8</span>);</span><br><span class="line">ExtEscapeSet(hdc, SETPOWERMANAGEMENT, size, vpm, <span class="number">0</span>, IntPtr.Zero);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">PowerOn</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">IntPtr hdc = GetDC(IntPtr.Zero);</span><br><span class="line"><span class="keyword">uint</span> size = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">byte</span>[] vpm = <span class="keyword">new</span> <span class="keyword">byte</span>[size];</span><br><span class="line"></span><br><span class="line"><span class="comment">//structure size</span></span><br><span class="line">BitConverter.GetBytes(size).CopyTo(vpm, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//dpms version</span></span><br><span class="line">BitConverter.GetBytes(<span class="number">0x0001</span>).CopyTo(vpm, <span class="number">4</span>);</span><br><span class="line"><span class="comment">//power state</span></span><br><span class="line">BitConverter.GetBytes((<span class="keyword">uint</span>)VideoPowerState.VideoPowerOn).CopyTo(vpm, <span class="number">8</span>);</span><br><span class="line">ExtEscapeSet(hdc, SETPOWERMANAGEMENT, size, vpm, <span class="number">0</span>, IntPtr.Zero);</span><br><span class="line">&#125;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">"coredll"</span>, EntryPoint=<span class="meta-string">"ExtEscape"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> <span class="keyword">int</span> <span class="title">ExtEscapeSet</span>(<span class="params"></span></span></span><br><span class="line"><span class="function"><span class="params">IntPtr hdc,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">uint</span> nEscape,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">uint</span> cbInput,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">byte</span>[] lpszInData,</span></span></span><br><span class="line"><span class="function"><span class="params"><span class="keyword">int</span> cbOutput,</span></span></span><br><span class="line"><span class="function"><span class="params">IntPtr lpszOutData</span></span></span><br><span class="line"><span class="function"><span class="params"></span>)</span>;</span><br><span class="line">[<span class="meta">DllImport(<span class="meta-string">"coredll"</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">extern</span> IntPtr <span class="title">GetDC</span>(<span class="params">IntPtr hwnd</span>)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> VideoPowerState : <span class="keyword">uint</span></span><br><span class="line">&#123;</span><br><span class="line">VideoPowerOn = <span class="number">1</span>,</span><br><span class="line">VideoPowerStandBy,</span><br><span class="line">VideoPowerSuspend,</span><br><span class="line">VideoPowerOff</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</div></article></div><div class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/post/2005-03-17-pda-battery-info-vb-net-net-cf-source-code/" class="post-title-link">PDA Battery Info (VB.Net+.Net CF) Source Code</a></h2><div class="post-info">Mar 17, 2005</div><div class="post-content"><p>PDA Battery Info (VB.Net+.Net CF) Source Code</p>
<figure class="highlight vbnet"><table><tr><td class="code"><pre><span class="line"><span class="comment">'======================================</span></span><br><span class="line"><span class="comment">' Get PDA Battery Info</span></span><br><span class="line"><span class="comment">'Summary:</span></span><br><span class="line"><span class="comment">' Using P/Invoke to get Battery Info.</span></span><br><span class="line"><span class="comment">'This technique is introduced in MSDN</span></span><br><span class="line"><span class="comment">'Library - January 2005 and this program</span></span><br><span class="line"><span class="comment">'is written based on the sample program</span></span><br><span class="line"><span class="comment">'of ms-help://MS.MSDNQTR.2005JAN.1033/dncfhowto/html/getpowstat.htm</span></span><br><span class="line"><span class="comment">'Functions:</span></span><br><span class="line"><span class="comment">' This program get PDA's battery info-</span></span><br><span class="line"><span class="comment">'mation containing main battery lifetime,</span></span><br><span class="line"><span class="comment">'voltage,current,and backup battery info.</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'2005/3/17</span></span><br><span class="line"><span class="comment">'Hesicong</span></span><br><span class="line"><span class="comment">'http://dream-world.nease.net</span></span><br><span class="line"><span class="comment">'http://blog.csdn.net/hesicong</span></span><br><span class="line"><span class="comment">'mailto:hesicong@mail.sc.cninfo.net</span></span><br><span class="line"><span class="keyword">Imports</span> System</span><br><span class="line"><span class="keyword">Imports</span> System.Drawing</span><br><span class="line"><span class="keyword">Imports</span> System.Collections</span><br><span class="line"><span class="keyword">Imports</span> System.Windows.Forms</span><br><span class="line"><span class="keyword">Imports</span> System.Data</span><br><span class="line"><span class="keyword">Imports</span> System.Runtime.InteropServices</span><br><span class="line"><span class="comment">' Summary description for Form1.</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Class</span> BatteryInfo</span><br><span class="line"><span class="keyword">Inherits</span> System.Windows.Forms.Form</span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> TextBox1 <span class="keyword">As</span> System.Windows.Forms.TextBox</span><br><span class="line"><span class="keyword">Private</span> mainMenu1 <span class="keyword">As</span> System.Windows.Forms.MainMenu</span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Sub</span> <span class="keyword">New</span>()</span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">' Required for Windows Form Designer support</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line">InitializeComponent()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span> <span class="comment">'New</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">' <span class="doctag">TODO:</span> Add any constructor code after InitializeComponent call</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">' Clean up any resources being used.</span></span><br><span class="line"><span class="keyword">Protected</span> <span class="keyword">Overloads</span> <span class="keyword">Overrides</span> <span class="keyword">Sub</span> Dispose(<span class="keyword">ByVal</span> disposing <span class="keyword">As</span> <span class="built_in">Boolean</span>)</span><br><span class="line"><span class="keyword">MyBase</span>.Dispose(disposing)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span> <span class="comment">'Dispose</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">Region</span> "Windows Form Designer generated code"</span></span><br><span class="line"><span class="comment">' Required method for Designer support - do not modify</span></span><br><span class="line"><span class="comment">' the contents of this method with the code editor.</span></span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> MenuItem4 <span class="keyword">As</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> MenuItem5 <span class="keyword">As</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> MenuItem7 <span class="keyword">As</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> Timer1 <span class="keyword">As</span> System.Windows.Forms.Timer</span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> mnuAutoRefresh <span class="keyword">As</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> mnuAbout <span class="keyword">As</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Friend</span> <span class="keyword">WithEvents</span> MenuItem1 <span class="keyword">As</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> InitializeComponent()</span><br><span class="line"><span class="keyword">Me</span>.mainMenu1 = <span class="keyword">New</span> System.Windows.Forms.MainMenu</span><br><span class="line"><span class="keyword">Me</span>.MenuItem4 = <span class="keyword">New</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Me</span>.MenuItem5 = <span class="keyword">New</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Me</span>.mnuAutoRefresh = <span class="keyword">New</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Me</span>.MenuItem7 = <span class="keyword">New</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Me</span>.mnuAbout = <span class="keyword">New</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="keyword">Me</span>.TextBox1 = <span class="keyword">New</span> System.Windows.Forms.TextBox</span><br><span class="line"><span class="keyword">Me</span>.Timer1 = <span class="keyword">New</span> System.Windows.Forms.Timer</span><br><span class="line"><span class="keyword">Me</span>.MenuItem1 = <span class="keyword">New</span> System.Windows.Forms.MenuItem</span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'mainMenu1</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.mainMenu1.MenuItems.Add(<span class="keyword">Me</span>.MenuItem4)</span><br><span class="line"><span class="keyword">Me</span>.mainMenu1.MenuItems.Add(<span class="keyword">Me</span>.mnuAbout)</span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'MenuItem4</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.MenuItem4.MenuItems.Add(<span class="keyword">Me</span>.MenuItem5)</span><br><span class="line"><span class="keyword">Me</span>.MenuItem4.MenuItems.Add(<span class="keyword">Me</span>.mnuAutoRefresh)</span><br><span class="line"><span class="keyword">Me</span>.MenuItem4.MenuItems.Add(<span class="keyword">Me</span>.MenuItem1)</span><br><span class="line"><span class="keyword">Me</span>.MenuItem4.MenuItems.Add(<span class="keyword">Me</span>.MenuItem7)</span><br><span class="line"><span class="keyword">Me</span>.MenuItem4.<span class="keyword">Text</span> = <span class="string">"Menu"</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'MenuItem5</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.MenuItem5.<span class="keyword">Text</span> = <span class="string">"Refresh"</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'mnuAutoRefresh</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.mnuAutoRefresh.<span class="keyword">Text</span> = <span class="string">"AutoRefresh"</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'MenuItem7</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.MenuItem7.<span class="keyword">Text</span> = <span class="string">"End"</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'mnuAbout</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.mnuAbout.<span class="keyword">Text</span> = <span class="string">"About"</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'TextBox1</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.TextBox1.Location = <span class="keyword">New</span> System.Drawing.Point(<span class="number">8</span>, <span class="number">8</span>)</span><br><span class="line"><span class="keyword">Me</span>.TextBox1.Multiline = <span class="literal">True</span></span><br><span class="line"><span class="keyword">Me</span>.TextBox1.ScrollBars = System.Windows.Forms.ScrollBars.Horizontal</span><br><span class="line"><span class="keyword">Me</span>.TextBox1.Size = <span class="keyword">New</span> System.Drawing.Size(<span class="number">224</span>, <span class="number">256</span>)</span><br><span class="line"><span class="keyword">Me</span>.TextBox1.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'Timer1</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.Timer1.Interval = <span class="number">1000</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'MenuItem1</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.MenuItem1.<span class="keyword">Text</span> = <span class="string">"SetRefreshInterval"</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="comment">'BatteryInfo</span></span><br><span class="line"><span class="comment">'</span></span><br><span class="line"><span class="keyword">Me</span>.Controls.Add(<span class="keyword">Me</span>.TextBox1)</span><br><span class="line"><span class="keyword">Me</span>.Menu = <span class="keyword">Me</span>.mainMenu1</span><br><span class="line"><span class="keyword">Me</span>.<span class="keyword">Text</span> = <span class="string">"BatteryInfo"</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span> <span class="comment">'InitializeComponent</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">End</span> <span class="meta-keyword">Region</span></span></span><br><span class="line"><span class="comment">' The main entry point for the application.</span></span><br><span class="line"><span class="keyword">Shared</span> <span class="keyword">Sub</span> Main()</span><br><span class="line">Application.Run(<span class="keyword">New</span> BatteryInfo)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span> <span class="comment">'Main</span></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Class</span> SYSTEM_POWER_STATUS_EX2</span><br><span class="line"><span class="keyword">Public</span> ACLineStatus <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BatteryFlag <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BatteryLifePercent <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> Reserved1 <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BatteryLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryFullLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> Reserved2 <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BackupBatteryFlag <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BackupBatteryLifePercent <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> Reserved3 <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BackupBatteryLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BackupBatteryFullLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryVoltage <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryCurrent <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryAverageCurrent <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryAverageInterval <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatterymAHourConsumed <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryTemperature <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BackupBatteryVoltage <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryChemistry <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Class</span> <span class="comment">'SYSTEM_POWER_STATUS_EX2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">Public</span> <span class="keyword">Class</span> SYSTEM_POWER_STATUS_EX</span><br><span class="line"><span class="keyword">Public</span> ACLineStatus <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BatteryFlag <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BatteryLifePercent <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> Reserved1 <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BatteryLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BatteryFullLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> Reserved2 <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BackupBatteryFlag <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BackupBatteryLifePercent <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> Reserved3 <span class="keyword">As</span> <span class="built_in">Byte</span></span><br><span class="line"><span class="keyword">Public</span> BackupBatteryLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">Public</span> BackupBatteryFullLifeTime <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Class</span> <span class="comment">'SYSTEM_POWER_STATUS_EX</span></span><br><span class="line">&lt;DllImport(<span class="string">"coredll"</span>)&gt; _</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Shared</span> <span class="keyword">Function</span> GetSystemPowerStatusEx(<span class="keyword">ByVal</span> lpSystemPowerStatus <span class="keyword">As</span> SYSTEM_POWER_STATUS_EX, <span class="keyword">ByVal</span> fUpdate <span class="keyword">As</span> <span class="built_in">Boolean</span>) <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line">&lt;DllImport(<span class="string">"coredll"</span>)&gt; _</span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Shared</span> <span class="keyword">Function</span> GetSystemPowerStatusEx2(<span class="keyword">ByVal</span> lpSystemPowerStatus <span class="keyword">As</span> SYSTEM_POWER_STATUS_EX2, <span class="keyword">ByVal</span> dwLen <span class="keyword">As</span> System.UInt32, <span class="keyword">ByVal</span> fUpdate <span class="keyword">As</span> <span class="built_in">Boolean</span>) <span class="keyword">As</span> System.UInt32</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Function</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Form1_Load(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> <span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs) <span class="keyword">Handles</span> <span class="keyword">MyBase</span>.Load</span><br><span class="line">RefreshStatus()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span> <span class="comment">'Form1_Load</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> RefreshStatus()</span><br><span class="line"><span class="keyword">Dim</span> status <span class="keyword">As</span> <span class="keyword">New</span> SYSTEM_POWER_STATUS_EX</span><br><span class="line"><span class="keyword">Dim</span> status2 <span class="keyword">As</span> <span class="keyword">New</span> SYSTEM_POWER_STATUS_EX2</span><br><span class="line">TextBox1.<span class="keyword">Text</span> = <span class="string">""</span></span><br><span class="line">TextBox1.<span class="keyword">Text</span> = <span class="string">"Sample Time:"</span> &amp; Format(Now, <span class="string">"HH:mm:ss"</span>) + vbCrLf + vbCrLf</span><br><span class="line"><span class="keyword">With</span> TextBox1</span><br><span class="line"><span class="keyword">If</span> Convert.ToInt32(GetSystemPowerStatusEx(status, <span class="literal">False</span>)) = <span class="number">1</span> <span class="keyword">Then</span></span><br><span class="line"><span class="comment">'Do some further work here</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">If</span> Convert.ToInt32(GetSystemPowerStatusEx2(status2, Convert.ToUInt32(Marshal.SizeOf(status2)), <span class="literal">False</span>)) = Marshal.SizeOf(status2) <span class="keyword">Then</span></span><br><span class="line"><span class="keyword">Select</span> <span class="keyword">Case</span> <span class="built_in">CInt</span>(status2.ACLineStatus.ToString)</span><br><span class="line"><span class="keyword">Case</span> <span class="number">0</span></span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"AC Status: Offline"</span> + vbCrLf</span><br><span class="line"><span class="keyword">Case</span> <span class="number">1</span></span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"AC Status: Online"</span> + vbCrLf</span><br><span class="line"><span class="keyword">Case</span> <span class="keyword">Else</span></span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"AC Status: Unknown"</span> + vbCrLf</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Select</span></span><br><span class="line">.<span class="keyword">Text</span> += vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"MainBattery"</span> + vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"-LifePercent:"</span> &amp; status2.BatteryLifePercent.ToString + vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"-Voltage:"</span> &amp; (<span class="built_in">CInt</span>(status2.BatteryVoltage.ToString) / <span class="number">1000</span>).ToString + <span class="string">"V"</span> + vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"-Current:"</span> &amp; status2.BatteryCurrent.ToString + <span class="string">"mA"</span> + vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"-Temperature:"</span> &amp; (<span class="built_in">CInt</span>(status2.BatteryTemperature.ToString) / <span class="number">10</span>).ToString + <span class="string">"℃"</span> + vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"BackupBattery"</span> + vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"-LifePercent:"</span> &amp; status2.BackupBatteryLifePercent.ToString + vbCrLf</span><br><span class="line">.<span class="keyword">Text</span> += <span class="string">"-Voltage:"</span> &amp; (<span class="built_in">CInt</span>(status2.BackupBatteryVoltage.ToString) / <span class="number">1000</span>).ToString + <span class="string">"V"</span> + vbCrLf</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">If</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">With</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> MenuItem3_Click(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs)</span><br><span class="line">Application.<span class="keyword">Exit</span>()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> MenuItem1_Click(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs)</span><br><span class="line">RefreshStatus()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> MenuItem7_Click(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs) <span class="keyword">Handles</span> MenuItem7.Click</span><br><span class="line">Application.<span class="keyword">Exit</span>()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> MenuItem5_Click(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs) <span class="keyword">Handles</span> MenuItem5.Click</span><br><span class="line">RefreshStatus()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> mnuAutoRefresh_Click(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs) <span class="keyword">Handles</span> mnuAutoRefresh.Click</span><br><span class="line">mnuAutoRefresh.Checked = <span class="keyword">Not</span> (mnuAutoRefresh.Checked)</span><br><span class="line">Timer1.Enabled = mnuAutoRefresh.Checked</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> Timer1_Tick(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs) <span class="keyword">Handles</span> Timer1.Tick</span><br><span class="line">RefreshStatus()</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> mnuAbout_Click(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs) <span class="keyword">Handles</span> mnuAbout.Click</span><br><span class="line">MsgBox(<span class="string">"Program by Hesicong"</span> &amp; vbCrLf &amp; <span class="string">"http://dream-world.nease.net"</span> &amp; vbCrLf &amp; <span class="string">" http://blog.csdn.net/hesicong"</span> &amp; vbCrLf &amp; <span class="string">"QQ:38288890"</span>, MsgBoxStyle.OKOnly, <span class="string">"About"</span>)</span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"><span class="keyword">Private</span> <span class="keyword">Sub</span> MenuItem1_Click_1(<span class="keyword">ByVal</span> sender <span class="keyword">As</span> System.<span class="built_in">Object</span>, <span class="keyword">ByVal</span> e <span class="keyword">As</span> System.EventArgs) <span class="keyword">Handles</span> MenuItem1.Click</span><br><span class="line">Timer1.Interval = <span class="built_in">CInt</span>(InputBox(<span class="string">"Please enter autorefresh interval(s)"</span>, <span class="string">"BatteryInfo"</span>, <span class="string">"1"</span>)) * <span class="number">1000</span></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Sub</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">End</span> <span class="keyword">Class</span> <span class="comment">'Form1</span></span><br></pre></td></tr></table></figure>

</div></article></div></div></div><div id="sidebar" class="left"><div id="about-panel"><div class="info"><div class="title">贺思聪</div><div class="bio">《爬虫实战：从数据到产品》作者，国内首个机票价格历史及预测小程序“爱飞狗旅行”作者，极客、架构师、大数据玩家。</div></div><img src="/images/avatar.png" class="avatar"></div><div id="friend-links-panel"><div class="panel-title"><p>LINKS</p></div><a href="http://github.com/derekhe" target="_blank" class="link-item"><div class="link-container"><div class="site-name">GitHub</div><div class="site-desc">http://github.com/derekhe</div></div></a><a href="http://www.jianshu.com/u/b1e713e56ea6" target="_blank" class="link-item"><div class="link-container"><div class="site-name">简书</div><div class="site-desc">http://www.jianshu.com/u/b1e713e56ea6</div></div></a><a href="https://www.linkedin.com/in/sicong-he-56a95437/" target="_blank" class="link-item"><div class="link-container"><div class="site-name">LinkedIn</div><div class="site-desc">https://www.linkedin.com/in/sicong-he-56a95437/</div></div></a></div></div></div><div class="clear"></div></main><footer class="footer-container"><div class="paginator"><a href="/page/135/" class="prev">PREV</a><a href="/page/137/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2020 <a href="http://www.april1985.com">贺思聪</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>var _mtac = {}; (function() {     var mta = document.createElement("script"); mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";    mta.setAttribute("name", "MTAH5");    mta.setAttribute("sid", "500490740");    var s = document.getElementsByTagName("script")[0];    s.parentNode.insertBefore(mta, s);})();</script></body></html>