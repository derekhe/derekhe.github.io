<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="aZ679hf2Rw"><title> Why docker use up all your disk space? · 我是思聪</title><meta name="description" content="Why docker use up all your disk space? - 贺思聪"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.april1985.com/atom.xml" title="我是思聪"><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129409069-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129409069-1');
</script>


<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">我是思聪</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>现在</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>曾经</p></a><ul class="shortcut-icons"><a href="https://github.com/derekhe" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">Why docker use up all your disk space?</h1><div class="post-info">Dec 9, 2016</div><div class="post-content"><p>I noticed that the docker containers are using more and more disk spaces on host machine. By looking at the disk usage inside docker container, you will not see any disk usage increase. But the aufs file system is increasing.</p>
<p>I found out that there are two days we can use to clean up the space:</p>
<ol>
<li>Restart docker service</li>
<li>Delete the docker container and add it back again.</li>
</ol>
<p>But these ways need stop your service and we still don’t know the root cause.</p>
<p>After a deep search, I finally found that the log file is eating my disk space and docker will not clean or limit the file size by default. My docker container has plenty of logs output to console, so the log file will keep increasing. If I restarted the docker service or recreate docker container, the log is clean up. Fortunately, docker provide us a <a href="https://docs.docker.com/engine/admin/logging/overview/" target="_blank" rel="noopener">option</a> to limit the log size:</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">--<span class="built_in">log</span>-<span class="keyword">opt</span> <span class="built_in">max</span>-size=[<span class="number">0</span>-<span class="number">9</span>]+[kmg]</span><br><span class="line">--<span class="built_in">log</span>-<span class="keyword">opt</span> <span class="built_in">max</span>-<span class="keyword">file</span>=[<span class="number">0</span>-<span class="number">9</span>]+</span><br><span class="line">--<span class="built_in">log</span>-<span class="keyword">opt</span> labels=label1,label2</span><br><span class="line">--<span class="built_in">log</span>-<span class="keyword">opt</span> env=env1,env2</span><br></pre></td></tr></table></figure>

<p>I recreated my container using max-size option to limit the log size to 100M when running docker.</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">docker <span class="builtin-name">run</span> <span class="built_in">..</span><span class="built_in">..</span> --log-opt <span class="attribute">max-size</span>=100M</span><br></pre></td></tr></table></figure>

<p>By doing this, the problem is solved. You can find out more options for log on that page to manage your log.</p>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/post/2017-02-05-mobike-unofficial-data-analysis/" class="prev">PREV</a><a href="/post/2016-08-24-api-deisgn-best-practices-txt/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2019 <a href="http://www.april1985.com">贺思聪</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>var _mtac = {}; (function() {     var mta = document.createElement("script"); mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";    mta.setAttribute("name", "MTAH5");    mta.setAttribute("sid", "500490740");    var s = document.getElementsByTagName("script")[0];    s.parentNode.insertBefore(mta, s);})();</script></body></html>