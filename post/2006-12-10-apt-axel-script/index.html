<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="aZ679hf2Rw"><title> apt-axel 脚本 · 我是思聪</title><meta name="description" content="apt-axel 脚本 - 贺思聪"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.april1985.com/atom.xml" title="我是思聪"><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129409069-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129409069-1');
</script>


<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">我是思聪</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>现在</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>曾经</p></a><ul class="shortcut-icons"><a href="https://github.com/derekhe" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">apt-axel 脚本</h1><div class="post-info">Dec 10, 2006</div><div class="post-content"><p>我把apt-axel脚本更改了一下，以适合自己的使用：<br>修改如下：</p>
<ul>
<li>使用一个server</li>
<li>使用mirror server达到更快的速度</li>
</ul>
<p>下面是apt-axel文件</p>
<figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line"></span><br><span class="line">###########################################################################</span><br><span class="line">#</span><br><span class="line"># Authors: Jes鷖 Espino Garc韆 &amp; Lucas Garc韆</span><br><span class="line"># Email: jespino@imap.cc</span><br><span class="line"># Date: <span class="number">31</span>/<span class="number">05</span>/<span class="number">2004</span></span><br><span class="line">#</span><br><span class="line"># This program is free software; you can redistribute it and/or modify</span><br><span class="line"># it under the terms <span class="keyword">of</span> the GNU General Public License <span class="keyword">as</span> published by</span><br><span class="line"># the Free Software Foundation; either version <span class="number">2</span> <span class="keyword">of</span> the License, or</span><br><span class="line"># (at your option) any later version.</span><br><span class="line">#</span><br><span class="line"># This program is distributed <span class="keyword">in</span> the hope that it will be useful,</span><br><span class="line"># but WITHOUT ANY WARRANTY; without even the implied warranty <span class="keyword">of</span></span><br><span class="line"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span><br><span class="line"># GNU General Public License for more details.</span><br><span class="line">#</span><br><span class="line"># You should have received a copy <span class="keyword">of</span> the GNU General Public License</span><br><span class="line"># along <span class="keyword">with</span> this program; <span class="keyword">if</span> not, write to the Free Software</span><br><span class="line"># Foundation, Inc., <span class="number">59</span> Temple Place, Suite <span class="number">330</span>, Boston, MA  <span class="number">02111</span><span class="number">-1307</span>  USA</span><br><span class="line">#</span><br><span class="line">###########################################################################</span><br><span class="line"></span><br><span class="line"># If the config file not exist, load the default parameters</span><br><span class="line"></span><br><span class="line">VERSION=<span class="string">"0.1"</span></span><br><span class="line">CONFIG_FILE=<span class="string">"/etc/apt-axel.conf"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> [ -f $CONFIG_FILE ]; then</span><br><span class="line">. $CONFIG_FILE</span><br><span class="line">else</span><br><span class="line"># Verbose TRUE or FALSE</span><br><span class="line">VERBOSE=<span class="string">"FALSE"</span></span><br><span class="line"></span><br><span class="line"># Conections</span><br><span class="line">CONNECTIONS=<span class="number">8</span></span><br><span class="line"></span><br><span class="line"># Servers</span><br><span class="line">server1=<span class="string">"ftp://ftp.de.debian.org/debian/"</span></span><br><span class="line">server2=<span class="string">"ftp://ftp.es.debian.org/debian/"</span></span><br><span class="line">server3=<span class="string">"ftp://ftp.fr.debian.org/debian/"</span></span><br><span class="line">server4=<span class="string">"ftp://ftp.it.debian.org/debian/"</span></span><br><span class="line">server5=<span class="string">"ftp://ftp.fi.debian.org/debian/"</span></span><br><span class="line">server6=<span class="string">"ftp://ftp.uk.debian.org/debian/"</span></span><br><span class="line">server7=<span class="string">"ftp://ftp.tk.debian.org/debian/"</span></span><br><span class="line">server8=<span class="string">"ftp://ftp.us.debian.org/debian/"</span></span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Set the package variable to be global</span><br><span class="line">package=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"># Show the help</span><br><span class="line">mostrar_ayuda() &#123;</span><br><span class="line">echo <span class="string">"Usage: apt-axel  "</span>;</span><br><span class="line">echo <span class="string">""</span>;</span><br><span class="line">echo <span class="string">"Options:"</span>;</span><br><span class="line">echo <span class="string">"  install - Install new packages (paquete es libc6 y no libc6.deb)"</span>;</span><br><span class="line">echo <span class="string">"  upgrade - Do a software upgrade"</span>;</span><br><span class="line">echo <span class="string">"  dist-upgrade - Do a distribution upgrade, see apt-get(8)"</span>;</span><br><span class="line">echo <span class="string">"  --version - Print the current version of apt-axel"</span>;</span><br><span class="line">echo <span class="string">"  --help - Show this help"</span>;</span><br><span class="line">echo <span class="string">""</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Get a package <span class="keyword">from</span> the ftp server</span><br><span class="line">get_package() &#123;</span><br><span class="line">descargar() &#123;</span><br><span class="line"># Check the $VERBOSE variable and the filesize, <span class="keyword">if</span> the filesize is lower than <span class="number">200</span>K will use only <span class="number">4</span> conections</span><br><span class="line"># And <span class="keyword">if</span> the $VERBOSE variable is TRUE, then print the axel output</span><br><span class="line"><span class="keyword">if</span> [ $VERBOSE == <span class="string">"TRUE"</span> ]; then</span><br><span class="line"><span class="keyword">if</span> [ $size -gt <span class="number">200000</span> ]; then</span><br><span class="line">echo $server1$url</span><br><span class="line">axel -a -n $CONNECTIONS $server1$url -o /tmp/$archivo -S $mirror1</span><br><span class="line">else</span><br><span class="line">axel -a -n <span class="number">4</span> $server1$url -o /tmp/$archivo -S $mirror1</span><br><span class="line">fi</span><br><span class="line">else</span><br><span class="line">echo -n <span class="string">"Geting $package package: "</span></span><br><span class="line"><span class="keyword">if</span> [ $size -gt <span class="number">200000</span> ]; then</span><br><span class="line">axel -a -n $CONNECTIONS $server1$url -o /tmp/$archivo -S $mirror1 &gt; /dev/null</span><br><span class="line">else</span><br><span class="line">axel -a -n <span class="number">4</span> $server1$url -o /tmp/$archivo -S $mirror1 &gt; /dev/null</span><br><span class="line">fi</span><br><span class="line">echo <span class="string">"Done"</span></span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># Getting data</span><br><span class="line">url=$(apt-cache show $package | grep ^Filename: | sed s/^Filename: <span class="comment">//)</span></span><br><span class="line">archivo=$(echo <span class="string">"$url"</span> | sed s/^.*$package/$package/)</span><br><span class="line">pkgstatus=$(dpkg -s $package <span class="number">2</span>&gt; /dev/null | grep ^Status: | grep -v <span class="string">"not-installed"</span>)</span><br><span class="line">md5sum=$(apt-cache show $package | grep ^MD5sum: | sed s/^MD5sum: <span class="comment">//)</span></span><br><span class="line">size=$(apt-cache show $package | grep ^Size: | sed s/^Size: <span class="comment">//)</span></span><br><span class="line"></span><br><span class="line"># Downloading the package</span><br><span class="line"><span class="keyword">if</span> [ -f /var/cache/apt/archives/$archivo ]; then</span><br><span class="line">echo -n <span class="string">"Package already downloaded. Checking md5sum of $package package: "</span></span><br><span class="line">while [ $md5sum != $(md5sum /var/cache/apt/archives/$archivo | sed s/ .*$<span class="comment">//) ]; do</span></span><br><span class="line">echo <span class="string">"incorrect"</span></span><br><span class="line">echo <span class="string">"Downloading again $package package."</span></span><br><span class="line">rm -f /var/cache/apt/archives/$archivo</span><br><span class="line">descargar</span><br><span class="line">done</span><br><span class="line">echo <span class="string">"correct"</span></span><br><span class="line">else</span><br><span class="line">descargar</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># Move the file to /var/cache/apt/archives</span><br><span class="line"><span class="keyword">if</span> [ -f /tmp/$archivo ]; then</span><br><span class="line"><span class="keyword">if</span> [ $md5sum == $(md5sum /tmp/$archivo | sed s/ .*$<span class="comment">//) ]; then</span></span><br><span class="line">mv -f /tmp/$archivo /var/cache/apt/archives/</span><br><span class="line">fi</span><br><span class="line">fi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">pkg_install() &#123;</span><br><span class="line">for package <span class="keyword">in</span> $(apt-get -s install $<span class="number">1</span> | grep ^Inst | sed s/^Inst <span class="comment">// | sed s/ .*$//); do</span></span><br><span class="line">get_package</span><br><span class="line">done</span><br><span class="line">apt-get -y install $<span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">upgrade() &#123;</span><br><span class="line">for package <span class="keyword">in</span> $(apt-get -s upgrade | grep ^Inst | sed s/^Inst <span class="comment">// | sed s/ .*$//); do</span></span><br><span class="line">get_package</span><br><span class="line">done</span><br><span class="line">apt-get -y upgrade</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">dist_upgrade() &#123;</span><br><span class="line">for package <span class="keyword">in</span> $(apt-get -s dist-upgrade | grep ^Inst | sed s/^Inst <span class="comment">// | sed s/ .*$//); do</span></span><br><span class="line">get_package</span><br><span class="line">done</span><br><span class="line">apt-get -y dist-upgrade</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#</span><br><span class="line"># Main program</span><br><span class="line">#</span><br><span class="line"><span class="keyword">if</span> [ `id -u` != <span class="number">0</span> ]; then</span><br><span class="line">echo <span class="string">"You must be root to run this command."</span></span><br><span class="line">else</span><br><span class="line"><span class="keyword">case</span> $<span class="number">1</span> <span class="keyword">in</span></span><br><span class="line">install) pkg_install $<span class="number">2</span>;;</span><br><span class="line">upgrade) upgrade;;</span><br><span class="line">dist-upgrade) dist_upgrade;;</span><br><span class="line">(--version) echo <span class="string">"Current Version: $VERSION"</span>;;</span><br><span class="line">(--help | -h) mostrar_ayuda;;</span><br><span class="line">*) mostrar_ayuda;;</span><br><span class="line">esac</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>配置文件：<br>GNU nano 1.3.12           File: /etc/apt-axel.conf</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Verbose TRUE or FALSE</span></span><br><span class="line"><span class="attr">VERBOSE</span>=<span class="string">"TRUE"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Conections</span></span><br><span class="line"><span class="attr">CONNECTIONS</span>=<span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Servers</span></span><br><span class="line"><span class="attr">server1</span>=<span class="string">"http://ubuntu.cnsite.org/ubuntu/"</span></span><br><span class="line"><span class="attr">mirror1</span>=<span class="string">"http://ubuntu.cn99.com/ubuntu/"</span></span><br></pre></td></tr></table></figure>

<p>[download id=”24”]</p>
</div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/post/2006-12-12-application-scim-in-english-environment/" class="prev">PREV</a><a href="/post/2006-12-10-autumn-school/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2020 <a href="http://www.april1985.com">贺思聪</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>var _mtac = {}; (function() {     var mta = document.createElement("script"); mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";    mta.setAttribute("name", "MTAH5");    mta.setAttribute("sid", "500490740");    var s = document.getElementsByTagName("script")[0];    s.parentNode.insertBefore(mta, s);})();</script></body></html>