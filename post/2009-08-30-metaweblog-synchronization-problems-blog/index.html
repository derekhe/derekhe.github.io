<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.9.0"><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="baidu-site-verification" content="aZ679hf2Rw"><title> metaWeblog同步博客遇到的问题 · 我是思聪</title><meta name="description" content="metaWeblog同步博客遇到的问题 - 贺思聪"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.ico"><link rel="stylesheet" href="/css/prontera.css"><link rel="search" type="application/opensearchdescription+xml" href="http://www.april1985.com/atom.xml" title="我是思聪"><!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-129409069-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-129409069-1');
</script>


<script>
  (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      if (curProtocol === 'https') {
          bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
      }
      else {
          bp.src = 'http://push.zhanzhang.baidu.com/push.js';
      }
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
  })();
  </script></head><body><header class="feature-header"><nav class="component-nav"><ul><div class="logo-container"><a href="/"><h2 class="title">我是思聪</h2></a></div><a href="/" target="_self" class="li component-nav-item"><p>现在</p></a><a href="/archives" target="_self" class="li component-nav-item"><p>曾经</p></a><ul class="shortcut-icons"><a href="https://github.com/derekhe" target="_blank"><img src="/images/github.svg" class="icon"></a><a href="/atom.xml" target="_blank"><img src="/images/rss.svg" class="icon"></a></ul></ul></nav></header><main class="container"><div id="post-container"><div class="post"><article class="post-block"><h1 class="post-title">metaWeblog同步博客遇到的问题</h1><div class="post-info">Aug 30, 2009</div><div class="post-content"><p>最近有一个迫切的需求，需要同步几个博客。目前我有的博客是本站，还有hesicong.cnblogs.com和<a href="http://www.csdn.net/hesicong共三个。其后两个由于各种问题长久以来没有得到更新。我的需求就是写一个软件能够将wordpress的文章同步到cnblogs和csdn(成为次博客)。对于主次博客都有的文章修改次博客为主博客内容，对于次博客没有的文章按照时间新建一个。从而实现博客同步。" target="_blank" rel="noopener">www.csdn.net/hesicong共三个。其后两个由于各种问题长久以来没有得到更新。我的需求就是写一个软件能够将wordpress的文章同步到cnblogs和csdn(成为次博客)。对于主次博客都有的文章修改次博客为主博客内容，对于次博客没有的文章按照时间新建一个。从而实现博客同步。</a></p>
<p>技术上使用metaWeblog就可以实现上述目的，选用python的xmlrpclib可以方便的进行xmlrpc操作。做一个控制台的小程序足够了我使用了。</p>
<p>然后开始技术实验，发现：</p>
<ol>
<li>wordpress支持metaWeblog很好，可以实现所有的功能。从wordpress可以通过metaWeblog.getRecentPosts函数得到所有的文章。</li>
<li>cnblogs也支持metaWeblog，也支持的很好。cnblogs也支持我的语法高亮。但遗憾的是：第一：metaWeblog.getRecentPosts函数最多能够返回100个文章。而我的cnblogs目前有230篇文章，很显然，cnblogs限制了文章数量；第二：metaWeblog.newPost函数即便Post结构中有dateCreated，但cnblogs的主界面中依然按照当前时间计算，造成文章时间对不上号，顺序混乱。</li>
<li>csdn就是个垃圾，metaWeblog表面上支持，暗地里出问题。metaWeblog.getRecentPosts,metaWeblog.editPost都无法用，提示User not exist。仅有metaWeblog.newPost可以用，但csdn的blog的语法高亮无法用，页面很难看。</li>
</ol>
<p>所以，想实现我的目的通过metaWeblog看来是没希望了。除非cnblogs调整文章数量限制，csdn希望从垃圾变成战斗机了。</p>
<p>附我写的一个测试代码，不完善，仅作为参考：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> xmlrpclib</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Metablog</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, url, username, password)</span>:</span></span><br><span class="line">        self.username=username</span><br><span class="line">        self.password=password</span><br><span class="line">        self.url=url</span><br><span class="line">        self.server=xmlrpclib.ServerProxy(url)</span><br><span class="line">        self.posts=<span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAllPosts</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Getting all posts from "</span>+self.url</span><br><span class="line">        self.posts=self.server.metaWeblog.getRecentPosts(<span class="string">''</span>, self.username, self.password, <span class="number">9999999</span>)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"found "</span>+ str(len(self.posts)) +<span class="string">" posts"</span></span><br><span class="line">        <span class="keyword">return</span> self.posts;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getAllPostTitle</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> self.posts==<span class="literal">None</span>:</span><br><span class="line">            self.getAllPosts()</span><br><span class="line"></span><br><span class="line">        ret=dict()</span><br><span class="line">        <span class="keyword">for</span> post <span class="keyword">in</span> self.posts:</span><br><span class="line">            ret[post[<span class="string">"postid"</span>]]=post[<span class="string">"title"</span>]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getPost</span><span class="params">(self, id)</span>:</span></span><br><span class="line">        <span class="keyword">for</span> post <span class="keyword">in</span> self.posts:</span><br><span class="line">            <span class="keyword">if</span> post[<span class="string">"postid"</span>]==id:</span><br><span class="line">                <span class="keyword">return</span> post</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">newPost</span><span class="params">(self, post)</span>:</span></span><br><span class="line">        self.server.metaWeblog.newPost(<span class="string">''</span>, self.username, self.password, post, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">editPost</span><span class="params">(self,postid, post)</span>:</span></span><br><span class="line">        self.server.metaWeblog.editPost(postid, self.username, self.password, post, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delPost</span><span class="params">(self, postid)</span>:</span></span><br><span class="line">        self.server.metaWeblog.deletePost(<span class="string">''</span>,postid, self.username, self.password, <span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">syncBlog</span><span class="params">(b1, b2)</span>:</span></span><br><span class="line">    b1Titles=b1.getAllPostTitle()</span><br><span class="line">    b2Titles=b2.getAllPostTitle()</span><br><span class="line">    <span class="keyword">for</span> key1,value1 <span class="keyword">in</span> b1Titles.iteritems():</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Blog1 title: "</span>+value1</span><br><span class="line">        <span class="keyword">for</span> key2,value2 <span class="keyword">in</span> b2Titles.iteritems():</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"tBlog2 title: "</span>+value2</span><br><span class="line">            <span class="keyword">if</span> value1==value2:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"Syncing, blog 2 postid="</span>+key2</span><br><span class="line">                b2.editPost(keys2, b1.getPost(key1))</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Blog2 has no article equal to title :"</span>+value1</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"Add new "</span></span><br><span class="line">        b2.newPost(b1.getPost(key1))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Done sync"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wpBlog=Metablog(<span class="string">"主站地址"</span>, <span class="string">"用户名"</span>, <span class="string">"密码"</span>)</span><br><span class="line">cnBlog=Metablog(<span class="string">"从站地址"</span>, <span class="string">"用户名"</span>, <span class="string">"密码"</span>)</span><br><span class="line">syncBlog(wpBlog, cnBlog)</span><br></pre></td></tr></table></figure></div></article></div></div></main><footer class="footer-container"><div class="paginator"><a href="/post/2009-09-01-green-energy/" class="prev">PREV</a><a href="/post/2009-08-29-installing-a-win7-mess-of-trouble-on-a-large-parra/" class="next">NEXT</a></div><div class="copyright"><p>© 2008 - 2020 <a href="http://www.april1985.com">贺思聪</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/AngryPowman/hexo-theme-prontera" target="_blank">hexo-theme-prontera</a>.</p></div></footer><script>var _mtac = {}; (function() {     var mta = document.createElement("script"); mta.src = "http://pingjs.qq.com/h5/stats.js?v2.0.2";    mta.setAttribute("name", "MTAH5");    mta.setAttribute("sid", "500490740");    var s = document.getElementsByTagName("script")[0];    s.parentNode.insertBefore(mta, s);})();</script></body></html>